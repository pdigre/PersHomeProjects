%REM: ----------------------------------------------------
%REM: Copyright (c) 2005-11 Esito AS. All rights reserved.
%REM: Version: 9.0.2. April 15, 2011.
%REM: ----------------------------------------------------
@reserved
ADD
ALL
ALLOCATE
ALTER
AND
ANY
ARE
AS
ASC
ASSERTION
AT
AUTHORIZATION
AVG
BEGIN
BETWEEN
BIGINT
BIT
BOOLEAN
BOTH
BY
CALL
CASCADE
CASCADED
CASE
CAST
CHAR
CHARACTER
CHECK
CLOSE
COALESCE
COLLATE
COLLATION
COLUMN
COMMIT
CONNECT
CONNECTION
CONSTRAINT
CONSTRAINTS
CONTINUE
CONVERT
CORRESPONDING
CREATE
CURRENT
CURRENT_DATE
CURRENT_TIME
CURRENT_TIMESTAMP
CURRENT_USER
CURSOR
DEALLOCATE
DEC
DECIMAL
DECLARE
DEFAULT
DEFERRABLE
DEFERRED
DELETE
DESC
DESCRIBE
DIAGNOSTICS
DISCONNECT
DISTINCT
DOUBLE
DROP
ELSE
END
END-EXEC
ESCAPE
EXCEPT
EXCEPTION
EXEC
EXECUTE
EXISTS
EXPLAIN
EXTERNAL
FALSE
FETCH
FIRST
FLOAT
FOR
FOREIGN
FOUND
FROM
FULL
FUNCTION
GET
GETCURRENTCONNECTION
GLOBAL
GO
GOTO
GRANT
GROUP
HAVING
HOUR
IDENTITY
IMMEDIATE
IN
INDICATOR
INITIALLY
INNER
INOUT
INPUT
INSENSITIVE
INSERT
INT
INTEGER
INTERSECT
INTO
IS
ISOLATION
JOIN
KEY
LAST
LEFT
LIKE
LOWER
LTRIM
MATCH
MAX
MIN
MINUTE
NATIONAL
NATURAL
NCHAR
NVARCHAR
NEXT
NO
NOT
NULL
NULLIF
NUMERIC
OF
ON
ONLY
OPEN
OPTION
OR
ORDER
OUTER
OUTPUT
OVERLAPS
PAD
PARTIAL
PREPARE
PRESERVE
PRIMARY
PRIOR
PRIVILEGES
PROCEDURE
PUBLIC
READ
REAL
REFERENCES
RELATIVE
RESTRICT
REVOKE
RIGHT
ROLLBACK
ROWS
RTRIM
SCHEMA
SCROLL
SECOND
SELECT
SESSION_USER
SET
SMALLINT
SOME
SPACE
SQL
SQLCODE
SQLERROR
SQLSTATE
SUBSTR
SUBSTRING
SUM
SYSTEM_USER
TABLE
TEMPORARY
TIMEZONE_HOUR
TIMEZONE_MINUTE
TO
TRANSACTION
TRANSLATE
TRANSLATION
TRUE
UNION
UNIQUE
UNKNOWN
UPDATE
UPPER
USER
USING
VALUES
VARCHAR
VARYING
VIEW
WHENEVER
WHERE
WITH
WORK
WRITE
XML
XMLEXISTS
XMLPARSE
XMLQUERY
XMLSERIALIZE
YEAR

@types
identity;int generated always as identity
smallint;smallint
int;integer
bigint;bigint
decimal;decimal%IF:HasPrecision%(%TypePrecision%%IF:HasScale%,%TypeScale%%ENDIF%)%ENDIF%
real;real
double;double
float;float%IF:HasPrecision%(%TypePrecision%)%ENDIF%
char;char(%IF:HasLength%%TypeLength%%ELSE%%DefaultTextLength%%ENDIF%)
varchar;varchar(%IF:HasLength%%TypeLength%%ELSE%%DefaultTextLength%%ENDIF%)
longvarchar;long varchar
charforbitdata;char(%IF:HasLength%%TypeLength%%ELSE%%DefaultTextLength%%ENDIF%) for bit data
varcharforbitdata;varchar(%IF:HasLength%%TypeLength%%ELSE%%DefaultTextLength%%ENDIF%) for bit data
longvarcharforbitdata;long varchar for bit data
clob;clob%IF:HasLength%(%TypeLength%)%ENDIF%
blob;blob%IF:HasLength%(%TypeLength%)%ENDIF%
date;date
time;time
timestamp;timestamp
xml;xml

@template
%SET:#fileNamePrefix = LOWER(NOWS(ModelName))%  
%SET:#fileNameDBA = #fileNamePrefix ++ "-dba.sql"%
%SET:#fileNameDrop = #fileNamePrefix ++ "-drop.sql"%
%SET:#fileNameSchema = #fileNamePrefix ++ "-schema.sql"%
%SET:#fileNameIndex = #fileNamePrefix ++ "-index.sql"%

%FILE% %#fileNameSchema%
-- %GeneratedWith%
--
-- Run this schema script against Derby as follows: 
-- java org.apache.derby.tools.ij %#fileNameSchema%

connect 'jdbc:derby:%ModelName%';

%INDENT%
-- CREATE TABLE statements including basic column definitions
%ITERATE:Table%
%IF:TableIsInDB%
CREATE TABLE %ID:TableName% (
%ITERATE:Column%
%LINE%
  %ID:ColumnName% %TYPE:DBType%
%IF:ColumnNotNull% NOT NULL%ENDIF%
%IF:TypeDefault% DEFAULT %TypeDefault%%ENDIF%
%IF:TypeConstraints% CHECK (%TypeConstraints%)%ENDIF%
%IF:!IsLast%,%ELSE%%IF:HasKey%,%ENDIF%%ENDIF%
%ENDLINE%
%ENDITERATE%
%IF:HasKey%
%ITERATE:Key%
  PRIMARY KEY (%IF:IsGroup%%ID:KeyEltNames%%ELSE%%KeyName%%ENDIF%)
%ENDITERATE%
%ENDIF%
);

%ENDIF%
%ENDITERATE%
%ENDFILE%

%FILE% %#fileNameIndex%
/* %GeneratedWith% */
--
-- Run this schema script against Derby as follows: 
-- java org.apache.derby.tools.ij %#fileNameIndex%

-- ALTER TABLE and CREATE FOREIGN KEY/INDEX statements
%ITERATE:Table%
%IF:TableIsInDB%

-- %ID:TableName%
%ITERATE:Column%
%IF:RelationForeignKey%
%IF:NotGroupMember%
ALTER TABLE %ID:TableName% ADD CONSTRAINT %ID:ConstraintName%F FOREIGN KEY (%ID:ColumnName%) REFERENCES %RelationForeignTable% (%RelationForeignKey%);
%ENDIF%
%ENDIF%
%ENDITERATE%
%ITERATE:Column%
%IF:!ColumnPrimaryKey%
%IF:ColumnIndex%
%LINE%
CREATE
%IF:ColumnUnique% UNIQUE%ENDIF%
 INDEX %ID:TableName%_%ID:ColumnName%_IX ON %ID:TableName% (%ID:ColumnName%);  
%ENDLINE%
%ENDIF%
%ENDIF%
%ENDITERATE%
%ITERATE:Group%
%IF:RelationForeignKey%
%IF:NotGroupMember%
ALTER TABLE %ID:TableName% ADD CONSTRAINT %ID:ConstraintName%F FOREIGN KEY (%ID:GroupEltNames%) REFERENCES %RelationForeignTable% (%RelationForeignKeyEltNames%);
%ENDIF%
%ENDIF%
%IF:!GroupPrimaryKey%
%IF:GroupIndex%
%LINE%
CREATE
%IF:GroupUnique% UNIQUE%ENDIF%
 INDEX %ID:GroupName% ON %ID:TableName% (%ID:GroupEltNames%); 
%ENDLINE%
%ENDIF%
%ENDIF%
%ENDITERATE%
%ENDIF%
%ENDITERATE%

exit;
%ENDINDENT%
%ENDFILE%

%INCLUDE% DerbyDBA.ptm
%INCLUDE% DerbyDrop.ptm
